<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="keywords" content="#">
    <meta name="description" content="#">
    <title>Car Dealer html5  Bootstrap Template  | Homepage</title>
    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/images/map_images/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/images/map_images/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/images/map_images/favicon.ico">
    <link rel="apple-touch-icon-precomposed" href="assets/images/map_images/favicon.ico">
    <link rel="shortcut icon" href="assets/images/map_images/favicon.png">
    <!-- Bootstrap -->
    <link href="assets/css/map_css/bootstrap.min.css" rel="stylesheet">
    <!-- Fontawesome -->
    <link href="assets/css/map_css/font-awesome.css" rel="stylesheet">
    <!-- Flaticons -->
    <link href="assets/css/map_css/font/flaticon.css" rel="stylesheet">
    <!-- Slick Slider -->
    <link href="assets/css/map_css/slick.css" rel="stylesheet">
    <!-- Range Slider -->
    <link href="assets/css/map_css/ion.rangeSlider.min.css" rel="stylesheet">
    <!-- Datepicker -->
    <link href="assets/css/map_css/datepicker.css" rel="stylesheet">
    <!-- magnific popup -->
    <link href="assets/css/map_css/magnific-popup.css" rel="stylesheet">
    <!-- Nice Select -->
    <link href="assets/css/map_css/nice-select.css" rel="stylesheet">
    <!-- Custom Stylesheet -->
    <link href="assets/css/map_css/style.css" rel="stylesheet">
    <!-- Custom Responsive -->
    <link href="assets/css/map_css/responsive.css" rel="stylesheet">
  
    <!-- CSS for IE -->
    <!--[if lte IE 9]>
            <link rel="stylesheet" type="text/css" href="css/ie.css" />
        <![endif]-->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
          <script type='text/javascript' src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
          <script type='text/javascript' src="http://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.js"></script>
        <![endif]-->
    <!-- place -->
    <style>
        #attractionsList {
            list-style-type: none;
            padding: 0;
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .attraction-item {
            display: flex;
            flex-direction: column;
            width: 280px;
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .attraction-item:hover {
            transform: scale(1.05);
        }

        .attraction-img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .attraction-info {
            padding: 15px;
        }

        .attraction-info h3 {
            margin: 0;
            font-size: 1.1em;
            color: #007bff;
        }

        .attraction-info p {
            margin: 5px 0;
            color: #555;
        }

        .weather-info {
            display: none;  /* 預設隱藏天氣資訊 */
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
    </style>
    <meta charset="UTF-8">
    <title>旅遊計畫</title>
    <script>
        async function loadGoogleMaps() {
            try {
                let response = await fetch("/get_google_maps_key");
                let data = await response.json();
                
                // ✅ **確保 API Key 存入全域變數**
                window.GOOGLE_API_KEY = data.apiKey;
        
                let script = document.createElement("script");
                script.src = `https://maps.googleapis.com/maps/api/js?key=${data.apiKey}&libraries=places`;
                script.async = true;
                script.defer = true;
                document.head.appendChild(script);
                script.onload = initMap;  // 確保地圖載入後初始化
            } catch (error) {
                console.error("❌ 無法載入 Google Maps API:", error);
            }
        }
    </script>
</head>
<body>
     <!-- Start Topbar -->
  <header class="header">
    <div class="topbar bg-theme">
      <div class="container">
        <div class="row">
          <div class="col-lg-6 col-md-5">
            <div class="leftside">
              <ul class="custom-flex">
                <li> <a href="#" class="text-custom-white"><i class="fab fa-facebook-f"></i></a> </li>
                <li> <a href="#" class="text-custom-white"><i class="fab fa-twitter"></i></a> </li>
                <li> <a href="#" class="text-custom-white"><i class="fab fa-instagram"></i></a> </li>
                <li> <a href="#" class="text-custom-white"><i class="fab fa-linkedin"></i></a> </li>
              </ul>
            </div>
          </div>
          <div class="col-lg-6 col-md-7">
            <div class="rightside full-height">
              <ul class="custom-flex full-height">
                <li class="book-appointment"> <a href="booking.html"> Booking Now </a> </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="navigation-wrapper">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <nav>
              <div class="main-navigation">
                <div class="logo"> <a href="index.html"> <img src="assets/images/logo.png" class="img-fluid" alt="logo"> </a> </div>
                <div class="main-menu">
                  <ul class="custom-flex">
                    <li class="menu-item active"> <a href="index.html">Home</a> </li>
                    <li class="menu-item menu-item-has-children"> <a href="#">Inventory</a>
                      <ul class="submenu custom">
                        <li class="menu-item"> <a href="cars.html">Full Width</a> </li>
                        <li class="menu-item"> <a href="cars-left-sidebar.html">Left Sidebar</a> </li>
                        <li class="menu-item"> <a href="cars-right-sidebar.html">Right Sidebar</a> </li>
                        <li class="menu-item"> <a href="car-detail.html">Inventory Detail</a> </li>
                      </ul>
                    </li>
                    <li class="menu-item menu-item-has-children"> <a href="#">Blog</a>
                      <ul class="submenu custom">
                        <li class="menu-item"> <a href="blog.html">Blog Grid</a> </li>
                        <li class="menu-item"> <a href="blog-left-sidebar.html">Blog Left</a> </li>
                        <li class="menu-item"> <a href="blog-right-sidebar.html">Blog right</a> </li>
                        <li class="menu-item"> <a href="blog-details.html">Blog Detail</a> </li>
                        <li class="menu-item"> <a href="blog-details-left-sidebar.html">Blog Detail Left</a> </li>
                        <li class="menu-item"> <a href="blog-details-right-sidebar.html">Blog Detail Right</a> </li>
                      </ul>
                    </li>
                    <li class="menu-item"> <a href="about.html">About</a> </li>
                    <li class="menu-item menu-item-has-children"> <a href="#">Pages</a>
                      <ul class="submenu custom">
                        <li class="menu-item"> <a href="booking.html">Booking</a> </li>
                        <li class="menu-item"> <a href="faqs.html">Faq</a> </li>
                        <li class="menu-item"> <a href="gallery.html">Gallery</a> </li>
                        <li class="menu-item"> <a href="404.html">404</a> </li>
                        <li class="menu-item"> <a href="coming-soon.html">Coming Soon</a> </li>
                      </ul>
                    </li>
                    <li class="menu-item"> <a href="contact.html">Contact</a> </li>
                  </ul>
                </div>
                <div class="hamburger-menu">
                  <div class="menu-btn"> <span></span> <span></span> <span></span> </div>
                </div>
              </div>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </header>
  <!-- End Topbar -->
  <!-- Header -->
<!-- Start Slider (變更為 Google 地圖) -->
<div class="slider p-relative">
  <div class="main-banner">
    <div id="map" style="width: 100%; height: 500px;"></div>
  </div>
</div>
<!-- End Slider -->
 <!-- Start Banner tabs (修改為輸入出發地 & 目的地 + 查詢按鈕) -->
<div class="container">
  <div class="banner-tabs">
    <div class="row">
      <div class="col-12">
        <div class="tabs">
          <div class="tab-content">
            <div class="tab-pane active" id="search">
              <div class="tab-inner">
                <form>
                  <div class="row">
                    <div class="col-lg-4 col-md-6">
                      <div class="form-group">
                        <label class="fs-14 text-custom-white fw-600">出發地</label>
                        <input id="start" type="text" class="form-control" placeholder="輸入出發地">
                      </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                      <div class="form-group">
                        <label class="fs-14 text-custom-white fw-600">目的地</label>
                        <input id="end" type="text" class="form-control" placeholder="輸入目的地">
                      </div>
                    </div>
                    <div class="col-lg-4 col-md-12 text-center">
                      <button type="button" class="btn btn-primary" onclick="planRoute()">規劃路線</button>
                      <button type="button" class="btn btn-success" onclick="fetchAttractions()">查詢景點</button>
                      <button type="button" class="btn btn-warning" onclick="fetchParking()">🚗 停車場</button>
                    </div>
                  </div>
                </form>
              </div> <!-- tab-inner -->
            </div> <!-- tab-pane -->
          </div> <!-- tab-content -->
        </div> <!-- tabs -->
      </div> <!-- col-12 -->
    </div> <!-- row -->
  </div> <!-- banner-tabs -->
</div> <!-- container -->
<!-- End Banner Tabs -->
  <!-- Start About Us -->
  <section class="section-padding about-us">
      <div class="row">
        <div class="col-xl-6 col-lg-6 p-0 m-0">
          <div class="about-right-side full-height">
            <div class="about-img full-height">
              <img src="assets/images/about_2.jpg" class="img-fluid image-fit" alt="img">
            </div>
          </div>
        </div>
        <div class="col-xl-6 col-lg-6 p-0 m-0 align-self-center text-left">
          <div class="about-left-side mb-md-80">
            <div class="section-header style-left">
              <div class="section-heading">
                <h3>Welcome To The <span class="text-custom">Car Dealer</span> </h3>
                <div class="section-description">
                </div>
              </div>
            </div>
            <p class="pt-2">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text.
              Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text.</p>
            <p class="pt-2">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text.</p>
            <p class="pt-2">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text. Lorem Ipsum has been the industry's standard dummy text.
              Lorem Ipsum is simply dummy.</p>
            <a href="#" class="btn btn-sm animated-button victoria-one">Reserve Now</a>
          </div>
        </div>
      </div>
  </section>
  <!-- End About Us -->
  <!-- Start Our work -->
 <!-- Start 天氣資訊 -->
<section class="weather-info section-padding bg-light-white">
  <div class="container">
    <div class="section-header text-center">
      <h3 class="text-custom-black">當地 <span class="text-custom">天氣資訊</span></h3>
    </div>
    <div class="text-center">
      <p id="weather-location">📍 地點：</p>
      <p id="weather-temp">🌡 溫度：</p>
      <p id="weather-desc">☁ 天氣狀況：</p>
      <p id="weather-humidity">💧 濕度：</p>
      <p id="weather-wind">💨 風速：</p>
      <img id="weather-icon" src="" alt="天氣圖示" style="display: none;">
    </div>
  </div>
</section>
<!-- End 天氣資訊 -->
<!-- Start Our Work (改為顯示景點 & 停車場資訊) -->
<section class="section-padding our-work-sec bg-light-white">
  <div class="container">
    <div class="section-header text-center">
      <h3 class="text-custom-black">景點 & <span class="text-custom">停車場資訊</span></h3>
    </div>
    <div class="row">
      <div class="col-12">
        <ul id="attractionsList"></ul>
        <ul id="parkingList"></ul>
      </div>
    </div>
  </div>
</section>
<!-- End Our Work -->
  <!-- End Our work -->
    <script>
        let map;
        let directionsService;
        let directionsRenderer;
        let speedCameraMarkers = [];
        let attractionMarkers = [];
        let parkingMarkers = [];

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 13,
                center: { lat: 25.033964, lng: 121.564472 } // 🔹 預設中心點（若無法獲取位置時使用）
            });
        
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);
        
        }

        function planRoute() {
            let start = document.getElementById("start").value;
            let end = document.getElementById("end").value;

            if (!start || !end) {
                alert("請輸入出發地和目的地！");
                return;
            }

            let request = {
                origin: start,
                destination: end,
                travelMode: "DRIVING"
            };

            directionsService.route(request, function(result, status) {
                if (status == "OK") {
                    directionsRenderer.setDirections(result);
                    let routePoints = result.routes[0].overview_path.map(point => ({
                        lat: point.lat(),
                        lng: point.lng()
                    }));
                    fetchSpeedCameras(routePoints);
                } else {
                    alert("路線規劃失敗: " + status);
                }
            });
        }

        function fetchSpeedCameras(routePoints) {
            fetch("/api/get_speed_cameras/", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken() 
                },
                body: JSON.stringify({ route: routePoints })
            })
            .then(response => response.json())
            .then(data => {
                console.log("📸 測速照相點:", data);
                addSpeedCamerasToMap(data.cameras);
            })
            .catch(error => console.error("❌ 測速相機 API 錯誤:", error));
        }

        function addSpeedCamerasToMap(cameras) {
            speedCameraMarkers.forEach(marker => marker.setMap(null)); 
            speedCameraMarkers = [];

            cameras.forEach(cam => {
                let marker = new google.maps.Marker({
                    position: { lat: cam.latitude, lng: cam.longitude },
                    map: map,
                    icon: "https://maps.google.com/mapfiles/ms/icons/red-dot.png",
                    title: "測速照相點"
                });
                speedCameraMarkers.push(marker);
            });
        }

        async function fetchAttractions() {
            // **直接從後端獲取 API Key**
            if (!window.GOOGLE_API_KEY) {
                console.warn("⏳ Google API Key 尚未載入，正在取得...");
                await loadGoogleAPIKey();  // ✅ 確保 API Key 正確載入
            }
        
            let end = document.getElementById("end").value;
            if (!end) {
                alert("請先輸入目的地！");
                return;
            }
        
            let geocoder = new google.maps.Geocoder();
            geocoder.geocode({ address: end }, function(results, status) {
                if (status === "OK") {
                    let location = results[0].geometry.location;
                    let lat = location.lat();
                    let lng = location.lng();
                     // 🔄 **搜尋景點後顯示當地天氣**
                    fetchWeatherInfo(lat, lng);
        
                    fetch(`/api/nearby_places?lat=${lat}&lng=${lng}&keyword=tourist attraction`)
                    .then(response => response.json())
                    .then(data => {
                        console.log("📍 附近景點 API 回應:", data);
        
                        if (data.error) {
                            alert(`❌ API 錯誤: ${data.error}`);
                            return;
                        }
        
                        if (data.places && data.places.length > 0) {
                            addAttractionsToMap(data.places);
                            displayAttractions(data.places);
                        } else {
                            alert("🚨 無法獲取景點資訊！");
                        }
                    })
                    .catch(error => console.error("❌ 景點 API 錯誤:", error));
                } else {
                    alert("無法解析目的地: " + status);
                }
            });
        }


        // **景點顯示**
        async function displayAttractions(places) {
            let list = document.getElementById("attractionsList");
            list.innerHTML = ""; // 清空現有列表
        
            if (!places || places.length === 0) {
                list.innerHTML = "<p>🚫 沒有找到景點，請更換地點再試。</p>";
                return;
            }
        
            console.log("✅ 正在顯示景點數量:", places.length);
            
            for (const place of places) {
                let originalName = place.name || "無名稱";
                let translatedName = await translateText(originalName, "zh-TW");  // **翻譯成中文**
                let address = place.vicinity || "地址不詳";
                let rating = place.rating ? `⭐ ${place.rating}` : "⭐ 無評分";
                let openingHours = place.opening_hours ? 
                    (place.opening_hours.open_now ? "🟢 營業中" : "🔴 已關門") : "⏳ 未提供營業時間";
        
                // ✅ **使用 Google 搜尋 URL（支援中文名稱）**
                let googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(translatedName)}`;
        
                // ✅ **獲取景點縮圖**
                let apiKey = window.GOOGLE_API_KEY || "";
                let photoUrl = place.photos && place.photos.length > 0
                    ? `https://maps.googleapis.com/maps/api/place/photo?maxwidth=400&photoreference=${place.photos[0].photo_reference}&key=${apiKey}`
                    : "https://via.placeholder.com/400?text=No+Image";
        
                // ✅ **HTML 結構**
                let li = document.createElement("li");
                li.classList.add("attraction-item");
                li.innerHTML = `
                    <a href="${googleSearchUrl}" target="_blank">
                        <img src="${photoUrl}" alt="${translatedName}" class="attraction-img">
                    </a>
                    <div class="attraction-info">
                        <h3>
                            <a href="${googleSearchUrl}" target="_blank" style="text-decoration: none; color: #007bff;">
                                ${translatedName} <!-- 確保顯示翻譯後的中文名稱 -->
                            </a>
                        </h3>
                        <p>${address}</p>
                        <p>${rating}</p>
                        <p>${openingHours}</p>
                    </div>
                `;
        
                list.appendChild(li);
            }
        }


        async function addAttractionsToMap(places) {
            attractionMarkers.forEach(marker => marker.setMap(null));
            attractionMarkers = [];
        
            for (const place of places) {
                let position = { lat: place.geometry.location.lat, lng: place.geometry.location.lng };
                let originalName = place.name || "無名稱";
                let translatedName = await translateText(originalName, "zh-TW");  // **翻譯成中文**
        
                let marker = new google.maps.Marker({
                    position: position,
                    map: map,
                    icon: "https://maps.google.com/mapfiles/ms/icons/blue-dot.png",
                    title: translatedName
                });
        
                let apiKey = window.GOOGLE_API_KEY || "";
                let photoUrl = place.photos && place.photos.length > 0
                    ? `https://maps.googleapis.com/maps/api/place/photo?maxwidth=200&photoreference=${place.photos[0].photo_reference}&key=${apiKey}`
                    : "https://via.placeholder.com/100?text=No+Image";
        
                let googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(translatedName)}`;
        
                let infoWindow = new google.maps.InfoWindow({
                    content: `
                        <div style="text-align: center;">
                            <img src="${photoUrl}" alt="${translatedName}" style="width: 100px; height: 100px; border-radius: 8px;">
                            <br>
                            <strong>
                                <a href="${googleSearchUrl}" target="_blank">${translatedName}</a>
                            </strong>
                        </div>
                    `
                });
        
                marker.addListener("click", () => {
                    infoWindow.open(map, marker);
                });
        
                infoWindow.open(map, marker);
                attractionMarkers.push(marker);
            }
        }

        async function fetchParking() {
            let end = document.getElementById("end").value;
            if (!end) {
                alert("請先輸入目的地！");
                return;
            }
        
            let geocoder = new google.maps.Geocoder();
            geocoder.geocode({ address: end }, function (results, status) {
                if (status === "OK") {
                    let location = results[0].geometry.location;
                    let lat = location.lat();
                    let lng = location.lng();
                    
                    // 🔄 **搜尋停車場後顯示當地天氣**
                    fetchWeatherInfo(lat, lng);
                    
                    // **🔄 讓地圖移動到搜尋的中心點**
                    map.setCenter({ lat: lat, lng: lng });
                    map.setZoom(15); // 調整適當的縮放級別
        
                    fetch(`/api/nearby_places?lat=${lat}&lng=${lng}&keyword=parking`)
                        .then(response => response.json())
                        .then(data => {
                            console.log("🅿️ 附近停車場 API 回應:", data);
        
                            if (data.error) {
                                alert(`❌ API 錯誤: ${data.error}`);
                                return;
                            }
        
                            if (data.places && data.places.length > 0) {
                                addParkingToMap(data.places);
                                displayParking(data.places);
                            } else {
                                alert("🚨 沒有找到附近的停車場！");
                            }
                        })
                        .catch(error => console.error("❌ 停車場 API 錯誤:", error));
                } else {
                    alert("無法解析目的地: " + status);
                }
            });
        }
        
        // 🅿️ **在地圖上顯示停車場（與景點相同格式）**
        async function addParkingToMap(places, centerLat, centerLng) {
             // ✅ 清除舊的標記（確保變數已定義）
            if (!Array.isArray(parkingMarkers)) {
                parkingMarkers = [];
            }

            parkingMarkers.forEach(marker => marker.setMap(null));
            parkingMarkers = [];
        
            let bounds = new google.maps.LatLngBounds(); // 📍 讓地圖適應所有標記
        
            for (const place of places) {
                let position = place.geometry?.location;
                if (!position || !position.lat || !position.lng) {
                    console.warn("⚠️ 無效的停車場位置:", place);
                    continue;  // 跳過錯誤的資料
                }
        
                let translatedName = await translateText(place.name || "無名稱", "zh-TW");
        
                let marker = new google.maps.Marker({
                    position: position,
                    map: map,
                    icon: "https://maps.google.com/mapfiles/ms/icons/green-dot.png",
                    title: translatedName
                });
        
                let apiKey = window.GOOGLE_API_KEY || "";
                let photoUrl = place.photos && place.photos.length > 0
                    ? `https://maps.googleapis.com/maps/api/place/photo?maxwidth=200&photoreference=${place.photos[0].photo_reference}&key=${apiKey}`
                    : "https://via.placeholder.com/100?text=No+Image";
        
                let googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(translatedName)} 停車場`;
        
                let infoWindow = new google.maps.InfoWindow({
                    content: `
                        <div style="text-align: center;">
                            <a href="${googleSearchUrl}" target="_blank">
                                <img src="${photoUrl}" alt="${translatedName}" style="width: 100px; height: 100px; border-radius: 8px;">
                            </a>
                            <br>
                            <strong>
                                <a href="${googleSearchUrl}" target="_blank">${translatedName}</a>
                            </strong>
                        </div>
                    `
                });
        
                marker.addListener("click", () => {
                    infoWindow.open(map, marker);
                });
        
                parkingMarkers.push(marker);
                bounds.extend(position); // 📍 擴展地圖邊界以包含標記
            }
        
            // 📌 **確保地圖調整至適合的縮放級別**
            if (places.length > 0) {
                map.fitBounds(bounds);
            } else {
                map.setCenter({ lat: centerLat, lng: centerLng });
                map.setZoom(15);
            }
        }
        
        // 🅿️ **在列表顯示停車場資訊（與景點相同格式）**
        async function displayParking(places) {
            let list = document.getElementById("attractionsList");
            let parkingSection = document.createElement("div");
            parkingSection.innerHTML = "<h3>🚗 附近停車場</h3>";
            list.appendChild(parkingSection);
        
            for (const place of places) {
                let originalName = place.name || "無名稱";
                let translatedName = await translateText(originalName, "zh-TW");
                let address = place.vicinity || "地址不詳";
                let rating = place.rating ? `⭐ ${place.rating}` : "⭐ 無評分";
        
                let googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(translatedName)} 停車場`;
        
                let apiKey = window.GOOGLE_API_KEY || "";
                let photoUrl = place.photos && place.photos.length > 0
                    ? `https://maps.googleapis.com/maps/api/place/photo?maxwidth=400&photoreference=${place.photos[0].photo_reference}&key=${apiKey}`
                    : "https://via.placeholder.com/400?text=No+Image";
        
                let li = document.createElement("li");
                li.classList.add("attraction-item");
                li.innerHTML = `
                    <a href="${googleSearchUrl}" target="_blank">
                        <img src="${photoUrl}" alt="${translatedName}" class="attraction-img">
                    </a>
                    <div class="attraction-info">
                        <h3>
                            <a href="${googleSearchUrl}" target="_blank" style="text-decoration: none; color: #007bff;">
                                ${translatedName}
                            </a>
                        </h3>
                        <p>${address}</p>
                        <p>${rating}</p>
                    </div>
                `;
        
                list.appendChild(li);
            }
        }

        function fetchWeatherInfo(lat, lon) {
            let weatherContainer = document.getElementById("weather-info");
            if (!weatherContainer) return;
        
            // **✅ 點擊後才顯示天氣資訊區塊**
            weatherContainer.style.display = "block";
        
            // **✅ 顯示「載入中...」，但不包含預設地點**
            document.getElementById("weather-location").textContent = `📍 地點：載入中...`;
            document.getElementById("weather-temp").textContent = `🌡 溫度：載入中...`;
            document.getElementById("weather-desc").textContent = `☁ 天氣狀況：載入中...`;
            document.getElementById("weather-humidity").textContent = `💧 濕度：載入中...`;
            document.getElementById("weather-wind").textContent = `💨 風速：載入中...`;
            
            fetch(`/api/weather/?lat=${lat}&lon=${lon}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error("❌ 無法獲取天氣資訊:", data.error);
                        return;
                    }
        
                    // **✅ 更新天氣資訊**
                    document.getElementById("weather-location").textContent = `📍 地點：${data.location}`;
                    document.getElementById("weather-temp").textContent = `🌡 溫度：${data.temperature}°C`;
                    document.getElementById("weather-desc").textContent = `☁ 天氣狀況：${data.description}`;
                    document.getElementById("weather-humidity").textContent = `💧 濕度：${data.humidity}%`;
                    document.getElementById("weather-wind").textContent = `💨 風速：${data.wind_speed} m/s`;
                })
                .catch(error => console.error("❌ 天氣 API 錯誤:", error));
        }
        


                // **名稱翻譯**
        async function translateText(text, targetLang = "zh-TW") {
            const response = await fetch(`/api/translate?text=${encodeURIComponent(text)}&target=${targetLang}`);
            const data = await response.json();
            return data.translatedText || text;  // 預防 API 失敗時，仍顯示原始名稱
        }

        function getCSRFToken() {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.startsWith('csrftoken=')) {
                        cookieValue = cookie.substring('csrftoken='.length, cookie.length);
                        break;
                    }
                }
            }
            return cookieValue;
        }


        window.onload = loadGoogleMaps;

    </script>
        <!-- Place all Scripts Here -->
    <!-- jQuery -->
    <script src="assets/js/map_js/jquery.min.js"></script>
    <!-- Popper -->
    <script src="assets/js/map_js/popper.min.js"></script>
    <!-- Bootstrap -->
    <script src="assets/js/map_js/bootstrap.min.js"></script>
    <!-- Range Slider -->
    <script src="assets/js/map_js/ion.rangeSlider.min.js"></script>
    <!-- Slick Slider -->
    <script src="assets/js/map_js/slick.min.js"></script>
    <!-- Datepicker -->
    <script src="assets/js/map_js/datepicker.js"></script>
    <script src="assets/js/map_js/datepicker.en.js"></script>
    <!-- Isotope Gallery -->
    <script src="assets/js/map_js/isotope.pkgd.min.js"></script>
    <!-- Nice Select -->
    <script src="assets/js/map_js/jquery.nice-select.js"></script>
    <!-- magnific popup -->
    <script src="assets/js/map_js/jquery.magnific-popup.min.js"></script>
    <!-- Custom Js -->
    <script src="assets/js/map_js/custom.js"></script>
    <!-- /Place all Scripts Here -->

</body>
</html>